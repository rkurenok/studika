"use strict";function testWebP(e){const t=new Image;t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA",t.onload=t.onerror=function(){2===t.height?e.classList.add("webp"):e.classList.add("webp-false")}}document.addEventListener("DOMContentLoaded",(function(){testWebP(document.body)}));let buttons=document.querySelectorAll(".button-reset"),inputs=document.querySelectorAll(".search-input");buttons.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),e.previousElementSibling.value="",e.classList.remove("active"),findCities("")}))})),inputs.forEach((e=>{let t=e.nextElementSibling;e.addEventListener("input",(()=>{e.value?t.classList.add("active"):t.classList.remove("active")}))}));let menuBurger=document.querySelector(".icon-menu");menuBurger.addEventListener("click",(function(){menuBurger.classList.toggle("active"),document.querySelector(".header__body").classList.toggle("active"),document.querySelector(".header__profile").classList.toggle("active"),document.querySelector(".header__bottom").classList.toggle("active"),document.querySelector(".header__city").classList.toggle("active"),document.querySelector(".header__search").classList.toggle("active")}));let arrayCities,cityBlock=document.querySelector(".header__city-block"),searchCitiesInput=document.querySelector(".search-input"),cityList=document.querySelector(".city-list"),headerCityText=document.querySelector(".header__city > span"),preloader=document.querySelector(".header__city-block__preloader"),cityCoockie=getCookie("city");function setHeaderCity(e){headerCityText.innerText="";for(let t=0;t<e.length;t++)headerCityText.innerHTML+=e[t].name,e[t+1]&&(headerCityText.innerHTML+=", ")}async function getСities(){let e=await fetch("https://studika.ru/api/areas",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"}}),t=await e.text();return JSON.parse(t)}function insertCities(e,t){let i,c;Array.from(e).forEach((e=>{i=document.createElement("div"),c=document.createElement("span");for(let t in e)"name"!=t?"cities"!=t&&(i.setAttribute("data-"+t,e[t]),i.classList.add("city-item")):(c.innerHTML=e[t],c.classList.add("city-name"));i.append(c),null!=t&&(c=document.createElement("span"),c.innerHTML=t,c.classList.add("area-name"),i.append(c)),cityList.append(i),"area"==i.dataset.type&&insertCities(e.cities,c.innerHTML)}))}function addSelectedCity(e,t){let i=document.createElement("div");i.classList.add("city-select"),i.setAttribute("data-id",t);let c=document.createElement("button");c.classList.add("header__city-select__button","button"),i.innerText=e,i.append(c),document.querySelector(".city-selected").append(i),document.querySelectorAll(".header__city-select__button").forEach((e=>{e.addEventListener("click",(e=>{e.stopPropagation();let t=e.target.closest("div").dataset.id;removeSelectedCity(t),document.querySelectorAll(".city-item").forEach((e=>{e.dataset.id==t&&(e.classList.remove("active"),e.style="")}))}))}))}function findCities(e){let t=document.querySelectorAll(".city-name");e=e.toLowerCase();for(let i=0;i<t.length;i++)if(t[i].innerText.toLowerCase().match(e))if((t[i].parentElement.style.display="none")&&(t[i].parentElement.style.display="block"),e){let c=t[i].innerText,o=c.toLowerCase().matchAll(e),n=0;t[i].innerHTML="";for(let a of o)t[i].innerHTML+=c.slice(n,a.index)+"<span>"+c.slice(a.index,a.index+e.length)+"</span>",n=a.index+e.length;t[i].innerHTML+=c.slice(n)}else t[i].children.length&&(t[i].innerHTML=t[i].innerText);else t[i].parentElement.style.display="none"}function removeSelectedCity(e){document.querySelectorAll(".city-select").forEach((t=>{t.dataset.id==e&&(t.classList.add("not-active"),setTimeout((()=>{t.remove()}),500))}))}function sendSaveData(e){let t=new XMLHttpRequest;t.open("POST","#",!1),t.send(e),t.onload=()=>console.log(t.response)}function setCookie(e,t,i={}){(i={path:"/",...i}).expires instanceof Date&&(i.expires=i.expires.toUTCString());let c=encodeURIComponent(e)+"="+encodeURIComponent(t);for(let e in i){c+="; "+e;let t=i[e];!0!==t&&(c+="="+t)}document.cookie=c}function getCookie(e){let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}function deleteCookie(e){setCookie(e,"",{"max-age":-1})}cityCoockie&&(cityCoockie=JSON.parse(cityCoockie),setHeaderCity(cityCoockie)),document.addEventListener("click",(async function(e){if(e.target.closest("div.header__city")&&!cityBlock.classList.contains("active")){if(cityBlock.classList.add("active"),null==arrayCities&&(arrayCities=await getСities(),insertCities(arrayCities),preloader.classList.add("hidden"),cityCoockie))for(let e=0;e<cityCoockie.length;e++){addSelectedCity(cityCoockie[e].name,cityCoockie[e].id);let t=document.querySelectorAll(".city-item");for(let i=0;i<t.length;i++)if(t[i].dataset.id==cityCoockie[e].id){t[i].classList.add("active"),t[i].style="background: #f1f1f1;";break}}}else cityBlock.classList.contains("active")&&!e.target.closest("div.header__city-block")&&cityBlock.classList.remove("active")})),searchCitiesInput.addEventListener("input",(()=>{findCities(searchCitiesInput.value)})),cityList.addEventListener("click",(e=>{let t=e.target.closest("div"),i=t.dataset.id;if(t.classList.contains("active"))removeSelectedCity(i),t.classList.remove("active"),t.style="";else{addSelectedCity(t.firstChild.innerText,i),t.classList.add("active"),t.style="background: #f1f1f1;"}})),document.querySelector(".city-save").addEventListener("click",(e=>{let t=[];document.querySelector(".city-select")?(document.querySelectorAll(".city-select").forEach((e=>{t.push({name:e.innerText,id:e.dataset.id})})),setCookie("city",JSON.stringify(t),{secure:!1,"max-age":3600}),sendSaveData(JSON.stringify(t))):(t[0]={name:"Любой регион",id:"null"},deleteCookie("city")),setHeaderCity(t),e.stopPropagation(),cityBlock.classList.remove("active")}));let ul=document.querySelector(".header__nav-list");function headerScroll(e){let t=document.querySelector(".header__bottom__scroll__right"),i=document.querySelector(".header__bottom__scroll__left"),c=document.querySelector(".header__body");t.addEventListener("click",(function(){c.scrollBy({top:0,left:e,behavior:"smooth"}),i.style.display="block",c.scrollWidth-c.scrollLeft-c.offsetWidth<=e+28&&(t.style.display="")})),i.addEventListener("click",(function(){c.scrollBy({top:0,left:-e,behavior:"smooth"}),t.style.display="block",c.scrollLeft<=e+28&&(i.style.display="")}));let o=document.querySelector("div.container").offsetWidth;ul.scrollWidth>o&&o>767.98&&(t.style.display="block")}headerScroll(200),ul.addEventListener("click",(e=>{ul.querySelectorAll("li > a").forEach((e=>{e.classList.contains("active")&&e.classList.remove("active")})),e.target.classList.add("active")}));